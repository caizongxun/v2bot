# BTC 15分鐘 K線預測模型 - 性能分析報告

**生成時間**: 2025-12-30  
**模型版本**: Improved with L2 Regularization + Dropout + Early Stopping

---

## 1. 模型訓練結果

### 整體性能
- **訓練集 MSE**: 0.915149
- **測試集 MSE**: 0.863024
- **Overfit 率**: -5.7% (實際上欠擬合)
- **Early Stopping**: 第 10 個 epoch 觸發

### 改進效果對比

| 指標 | 原始模型 | 改進後 | 改善幅度 |
|------|--------|--------|----------|
| Test Loss | 5.3 (嚴重過擬合) | 0.863 | ✅ 大幅改善 |
| Overfit 率 | ~620% | -5.7% | ✅ 從過擬合→欠擬合 |
| 泛化能力 | 極差 | 良好 | ✅ 顯著提升 |

---

## 2. 各指標預測性能分析

### 2.1 價格相關指標 (BB_Upper, BB_Lower, Support, Resistance)

```
BB_Upper:      MSE=0.730, R²=-0.157  ⚠️  預測範圍過小
BB_Lower:      MSE=0.727, R²=-0.153  ⚠️  預測範圍過小
Support:       MSE=0.722, R²=-0.146  ⚠️  預測範圍過小
Resistance:    MSE=0.727, R²=-0.154  ⚠️  預測範圍過小
```

**核心問題**: 
- 實際值範圍: [-0.97, 2.29] (標準化後的跨度很大)
- 預測值範圍: [0.05, 0.31] (模型過於保守)
- **症狀**: 模型在"安全區間"內預測，無法捕捉極端情況

**原因分析**:
1. L2 正則化懲罰大的權重變化 → 模型輸出被壓制
2. Dropout 隨機關閉神經元 → 預測能力削弱
3. 歸一化數據中的異常值 (outliers) 沒有被充分處理

---

### 2.2 動量指標 (RSI, MACD, MACD_Signal)

```
RSI:           MSE=1.011, R²=-0.001  ⚠️  基本無預測能力
MACD:          MSE=0.995, R²=-0.001  ⚠️  基本無預測能力
MACD_Signal:   MSE=0.993, R²=-0.002  ⚠️  基本無預測能力
```

**核心問題**:
- 這些指標高度非線性，當前的簡單神經網路無法學習
- R² ≈ 0 表示預測結果與隨機猜測無異

---

## 3. 最新預測信號分析

### 實際 vs 預測

```
📊 Bollinger Band:
  上軌: 實際=-0.683  →  預測=+0.219  (差異: 0.902)
  下軌: 實際=-0.658  →  預測=+0.225  (差異: 0.883)

🎯 支撐/阻力:
  支撐: 實際=-0.645  →  預測=+0.235  (差異: 0.880)
  阻力: 實際=-0.643  →  預測=+0.226  (差異: 0.869)

📈 RSI:
  實際=0.234 (61.71%)  →  預測=0.016 (50.79%)  (差異: 0.218)

🔄 MACD:
  實際=-0.722  →  預測=+0.010  (差異: 0.732)
  信號: 實際=-1.054  →  預測=+0.017  (差異: 1.071)
```

**關鍵發現**: 當市場處於極端狀態 (負值區間) 時，模型**完全無法預測**。

---

## 4. 根本問題診斷

### 問題 A: 模型容量不足
- 當前架構: Input(9) → Dense(256) → ReLU → Dropout(0.2) → Dense(8)
- **症狀**: 單層隱藏層無法學習複雜的市場規律
- **證據**: R² 為負值，表示模型甚至不如預測均值

### 問題 B: 正則化過度
- L2 正則化係數: 0.0001 (實際可能還需要再調）
- Dropout: 0.2 
- **症狀**: 模型為了避免過擬合，寧願放棄準確性
- **結果**: 欠擬合 (Underfit) 比過擬合更嚴重

### 問題 C: 特徵工程不足
- 當前只用了基本的技術指標
- **缺失**: 
  - 多時間尺度特徵 (1h, 4h, 1d)
  - 成交量相關特徵
  - 市場情緒指標
  - 費波那契回調位

### 問題 D: 數據品質
- 標準化後有大量異常值
- **可能原因**: 市場突發事件、流動性不足、數據質量問題

---

## 5. 改進方案

### 短期 (立即可行)

```python
# 1. 移除過度正則化
L2_lambda = 0  # 先取消 L2 正則化，測試基線
Dropout_rate = 0  # 先移除 Dropout

# 2. 增加模型容量
model = {
    'W1': np.random.randn(9, 512) * 0.01,      # 9 → 512
    'b1': np.zeros((1, 512)),
    'W2': np.random.randn(512, 8) * 0.01,      # 512 → 8
    'b2': np.zeros((1, 8))
}

# 3. 檢查並清理異常值
outliers = np.abs(y_train) > 3.0  # 3-sigma rule
y_train_clean = y_train[~outliers]
X_train_clean = X_train[~outliers]
```

### 中期 (1-2天)

1. **改進特徵工程**
   ```python
   # 添加多時間尺度特徵
   features = {
       'current': indicators_15m,
       'hour': indicators_1h,
       'day': indicators_1d,
       'volume': volume_features,
       'volatility': volatility_features
   }
   ```

2. **改進模型架構**
   ```python
   # 使用更深的網路或 LSTM
   # 考慮 Residual Connections
   ```

3. **改進訓練策略**
   ```python
   # 使用 Adam optimizer（自動學習率調整）
   # 分層訓練（先訓練價格，再訓練動量）
   ```

### 長期 (1周+)

1. **考慮遞迴網路 (LSTM/GRU)**
   - 時間序列預測的標準方案
   - 可以學習長期依賴關係

2. **融合多個模型**
   - 價格預測：CNN + LSTM
   - 動量預測：Transformer
   - 最終融合：Attention Mechanism

3. **引入外部數據**
   - 交易所資金流
   - 鏈上數據（Whale 活動）
   - 期貨持倉比例

---

## 6. 立即行動計畫

### Step 1: 驗證基線 (1小時)
```bash
# 移除所有正則化，測試模型實際容量
python step2_train_improved.py --l2_lambda=0 --dropout=0
```

### Step 2: 特徵改進 (2小時)
```python
# 增加特徵維度和多時間尺度
# 目標: 從 9 個特徵 → 30+ 個特徵
```

### Step 3: 模型擴展 (2小時)
```python
# 增加隱藏層大小
# 512 neurons → 更強的表達能力
```

### Step 4: 完整重訓 (30分鐘)
```bash
python step2_train_improved.py
python run_visualization.py
```

---

## 7. 評估指標

在改進時，使用以下指標評估進度:

| 指標 | 當前值 | 目標值 | 優先級 |
|------|--------|--------|--------|
| Test R² (BB) | -0.157 | > 0.5 | 🔴 高 |
| Test R² (RSI) | -0.001 | > 0.3 | 🔴 高 |
| 預測範圍覆蓋度 | 13% | > 70% | 🔴 高 |
| Overfit 率 | -5.7% | 5-15% | 🟡 中 |
| 整體 MSE | 0.863 | < 0.5 | 🟡 中 |

---

## 8. 下一步指示

**建議方向**:

1. ✅ **先嘗試移除正則化** - 確認是否是過度懲罰
2. ✅ **增加隱藏層大小** - 測試模型容量
3. ✅ **改進特徵工程** - 添加更多相關特徵
4. ✅ **考慮 LSTM** - 對時間序列更友好

**不建議**:
- ❌ 盲目增加訓練時間（會陷入局部最優）
- ❌ 使用更強的正則化（會加重欠擬合）
- ❌ 增加數據量（質量比數量重要）

---

*報告由 v2bot 自動生成 | 下次更新: 模型改進後*
